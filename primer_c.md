Язык Си в примерах/Использование аргументов командной строки
Материал из Викиучебника — открытых книг для открытого мира
< Язык Си в примерах

Язык Си в примерах

    Компиляция программ
    Простейшая программа «Hello World»
    Учимся складывать
    Максимум
    Таблица умножения
    ASCII-коды символов
    Верхний регистр
    Скобочки
    Факториал
    Степень числа
    Треугольник Паскаля
    Корень уравнения
    Система счисления
    Сортировка
    Библиотека complex
    Сортировка на основе qsort
    RPN-калькулятор
    RPN-калькулятор на Bison
    Простая грамматика
    Задача «Расчёт сопротивления схемы»
    Простая реализация конечного автомата
    Использование аргументов командной строки
    Чтение и печать без использования stdio
    Декодирование звукозаписи в формате ADX
    Другие примеры

Содержание

    1 Аргументы командной строки
    2 Подробнее об аргументах командной строки
        2.1 Пример 2
    3 Задачи для самостоятельного решения
    4 См. также

Аргументы командной строки

Программы могут принимать аргументы. Ниже приведен пример программы argv, которая печатает список аргументов, которые были переданы ей в командной строке. Пример ее работы:

bash$ ./argv alpha beta gamma last
Argument 0: ./argv
Argument 1: alpha
Argument 2: beta
Argument 3: gamma
Argument 4: last


 /* 
    Build me with
      gcc -o argv argv.c
 */
 #include <stdio.h>
 int main (int argc, char * argv[]) {
         int i;
         for( i = 0 ; i < argc; i++) {
                 printf("Argument %d: %s\n", i, argv[i]);
         }
         if(argc == 1) {
                 printf("Command line has no additional arguments\n");
         }
         return 0;
 }

Например стандартная программа 'ls' в Linux в качестве аргумента принимает имена директорий, содержимое которых нужно вывести в стандартный поток вывода. Команда

bash$ ls /home/user

выведет содержимое директории '/home/user'.

Команда 'ls' имеет множество опций, которые можно передавать в командной строке. О них вы можете узнать, запустив команду 'ls' с опцией '-h':

bash$ ls -h

Вообще, программа может получать данные из нескольких источников. Наиболее важные источники это:

    аргументы командной строки;
    стандартный поток ввода;
    файлы;
    средства взаимодействия процессов (signals, sockets, messages, ...).

Научимся использовать первый из них.
Подробнее об аргументах командной строки

Основной функцией в программе на языке Си является функция main(). Мы уже познакомились с простейшим способом объявления этой функции:

 /*
 * Простейшая форма main()
 */
 int main() {
 
     // ...
 
     return 0;
 }

Для того, чтобы ваша программа могла анализировать параметры, передаваемые ей через командную строку, функцию main() следует описать несколько сложнее:

 /*
 * main() с обработкой параметров
 */
 int main(int argc, char **argv) {
 
     // ...
 
     return 0;
 }

При такой записи, при вызове вашей программы, параметр argc будет содержать количество параметров командной строки плюс один. Действительные параметры нумеруются с единицы по argc-1 включительно (т.е. всего argc-1 параметров), параметр под номером ноль является служебным — он содержит полный путь и имя исполняемого файла вашей программы.

Для доступа к параметру под номером i следует писать argv[i]. Выражение argv[i] — это строка, передаваемая в соответствии с соглашениями языка Си о строках. С ней можно проделывать все операции, как с обычной строкой (её даже можно модифицировать, но это считается дурным тоном!).

Вот еще один пример программы, работающей со своей командной строкой:
Пример 2

 /*
 * Пример программы, работающей со своей командной строкой
 */
 #include <stdio.h>
 #include <string.h>
 int main(int argc, char **argv) {
     if(argc <= 1) {
         printf("syntax : \n\t%s --help or\n\t./p --add [a] [b]\n", argv[0]);
         return 0;
     }
     if(!strcmp(argv[1], "--help")) {
         printf("You requested help message.\n");
     } else if(!strcmp(argv[1], "--add")) {
         if(argc <= 3) {
             printf("'--add' operation requires two parameters.\n");
         } else {
             int a, b;
             if(sscanf(argv[2], "%d", &a) != 1 || sscanf(argv[3], "%d", &b) != 1) {
                 printf("'--add' operation requires two integer parameters.\n");
             } else {
                 printf("%d + %d = %d\n", a, b, a+b);
             }
         }
     } else {
         printf("Unknown parameter: '%s'. Type %s --help for help.\n", argv[1], argv[0]);
     }
     return 0;
 }

